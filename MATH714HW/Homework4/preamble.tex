% Common LaTeX preamble. Save as preamble.tex and \input{preamble} after \documentclass.
% Engine detection
\usepackage{iftex}
\ifPDFTeX
    \usepackage[T1]{fontenc}
    \usepackage[utf8]{inputenc} % harmless on newer LaTeX
    \usepackage{lmodern}
    \usepackage[english]{babel}
    \usepackage{inconsolata} % better mono font
\else
    \usepackage{fontspec}
    \defaultfontfeatures{Ligatures=TeX,Scale=MatchLowercase}
    \setmainfont{Latin Modern Roman}
    \setsansfont{Latin Modern Sans}
    \setmonofont{Latin Modern Mono}
    \usepackage{polyglossia}
    \setmainlanguage{english}
\fi

% Page geometry and layout
\usepackage[margin=1in]{geometry}
\usepackage{microtype}
\usepackage{setspace}
% \onehalfspacing % uncomment for 1.5 line spacing

% Graphics and color
\usepackage{xcolor}
\usepackage{graphicx}
\graphicspath{{figures/}}
\usepackage{tikz}
\usetikzlibrary{arrows.meta,positioning,calc,fit,patterns,decorations.pathmorphing}
\usepackage{pgfplots}
\pgfplotsset{compat=1.18}

% Tables
\usepackage{booktabs}
\usepackage{tabularx}
\usepackage{array}
\newcolumntype{Y}{>{\centering\arraybackslash}X}

% Lists
\usepackage{enumitem}
\setlist{itemsep=0.25em, topsep=0.5em}

% Math packages
\usepackage{amsmath,amssymb,mathtools,bm, nicefrac}
\allowdisplaybreaks
\usepackage{siunitx}
\sisetup{detect-all=true, per-mode=symbol, group-minimum-digits=4}

% Theorems
\usepackage{amsthm}
\numberwithin{equation}{section}
\newtheorem{theorem}{Theorem}[section]
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem{proposition}[theorem]{Proposition}
\theoremstyle{definition}
\newtheorem{definition}[theorem]{Definition}
\theoremstyle{remark}
\newtheorem{remark}[theorem]{Remark}
\newtheorem{example}[theorem]{Example}

% Code listings
\usepackage{listings}
\lstdefinestyle{code}{
    basicstyle=\ttfamily\small,
    numbers=left,
    numberstyle=\scriptsize\color{gray},
    stepnumber=1,
    numbersep=8pt,
    showstringspaces=false,
    breaklines=true,
    frame=lines,
    tabsize=2,
    captionpos=b,
    keywordstyle=\color{blue!70!black}\bfseries,
    commentstyle=\color{green!50!black}\itshape,
    stringstyle=\color{orange!60!black},
}
\lstset{style=code}

% Captions and subfigures
\usepackage[labelfont=bf]{caption}
\usepackage{subcaption}

% Hyperlinks and clever references
\usepackage[hidelinks]{hyperref}
\hypersetup{
    pdftitle={},
    pdfauthor={},
    pdfsubject={},
    pdfcreator={LaTeX},
    pdfkeywords={}
}
\usepackage[capitalize,noabbrev]{cleveref}

% Citations (BibLaTeX)
\usepackage{csquotes}
\usepackage[
    backend=biber,
    style=authoryear,
    natbib=true,
    giveninits=true,
    maxbibnames=99,
    uniquename=init
]{biblatex}
% \addbibresource{references.bib}

% Headers/footers
\usepackage{fancyhdr}
\pagestyle{fancy}
\fancyhf{}
\lhead{\leftmark}
\rhead{\thepage}

% Utility packages
\usepackage{lastpage}
\usepackage[textsize=footnotesize]{todonotes} % \todo{...}

% Paragraph spacing
\setlength{\parskip}{0.5em}
\setlength{\parindent}{0pt}

% TOC and numbering depth
\setcounter{secnumdepth}{3}
\setcounter{tocdepth}{2}

% Common macros
\newcommand{\R}{\mathbb{R}}
\newcommand{\N}{\mathbb{N}}
\newcommand{\Z}{\mathbb{Z}}
\newcommand{\Q}{\mathbb{Q}}
\newcommand{\E}{\mathbb{E}}
\newcommand{\Var}{\operatorname{Var}}
\newcommand{\Cov}{\operatorname{Cov}}
\newcommand{\argmin}{\operatorname*{arg\,min}}
\newcommand{\argmax}{\operatorname*{arg\,max}}
\newcommand{\calC}{\mathcal{C}}
\newcommand{\calF}{\mathcal{F}}
\newcommand{\norm}[1]{\left\lVert #1 \right\rVert}
\newcommand{\abs}[1]{\left\lvert #1 \right\rvert}
\newcommand{\set}[1]{\left\{ #1 \right\}}
\newcommand{\ip}[2]{\left\langle #1,\, #2 \right\rangle}
\DeclarePairedDelimiter{\ceil}{\lceil}{\rceil}
\DeclarePairedDelimiter{\floor}{\lfloor}{\rfloor}

% Problem environment
\usepackage{tcolorbox}
\newcounter{problemCounter}
\newtcolorbox{problem}[2][]{colback=white, colframe=black, boxrule=0.5mm, arc=4mm, auto outer arc, title={\ifstrempty{#1}{Problem \stepcounter{problemCounter}\theproblemCounter}{#1}}}


% Draft helpers
\newif\ifdraft
\draftfalse
% \drafttrue
\ifdraft
    \overfullrule=2pt
    \usepackage[inline]{showlabels}
    \usepackage{refcheck}
\fi

% Usage:
% \documentclass{article}
% \input{preamble}
% \title{Title}\author{Author}\date{\today}
% \begin{document}\maketitle
% ...
% \printbibliography % if using BibLaTeX
% \end{document}